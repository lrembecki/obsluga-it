import{c as R}from"./chunk-5PREXRHO.js";import{R as A}from"./chunk-2YE4WXBL.js";import{c as Q,u as P}from"./chunk-VSR5JVYN.js";import{$a as s,$b as V,Ab as F,Bb as N,Ib as B,Ja as y,Q as q,S as f,Tb as g,Ub as O,Va as p,Wa as _,X as b,Xa as M,Y as C,Ya as T,Yb as I,Za as x,Zb as v,_a as c,ac as $,da as u,hb as D,jb as S,lb as a,ua as d,zb as l}from"./chunk-WWCH6M6L.js";var G=e=>({sortable:e}),H=(e,n)=>n.label+n.field;function J(e,n){return n[this.rowIdField()]}var U=(e,n)=>n.label;function W(e,n){if(e&1&&(c(0,"span",2),l(1),s()),e&2){let o=a().$implicit,r=a();d(),F(r.getSortIndicator(o))}}function X(e,n){if(e&1){let o=D();c(0,"th",0)(1,"button",1),S("click",function(){let t=b(o).$implicit,i=a();return C(i.toggleSort(t))}),l(2),p(3,W,2,1,"span",2),s()()}if(e&2){let o=n.$implicit,r=a();x("ngClass",B(3,G,o.sortable)),d(2),N(" ",o.label," "),d(),_(o.sortable&&r.getSortIndicator(o)?3:-1)}}function Y(e,n){if(e&1&&(c(0,"a",3),l(1),s()),e&2){let o=a().$implicit,r=a().$implicit,t=a();x("routerLink",t.getRenderLink(o,r)),d(),F(t.renderCell(r,o))}}function Z(e,n){if(e&1&&l(0),e&2){let o=a().$implicit,r=a().$implicit,t=a();N(" ",t.renderCell(r,o)," ")}}function ee(e,n){if(e&1&&(c(0,"td"),p(1,Y,2,2,"a",3)(2,Z,1,1),s()),e&2){let o=n.$implicit;d(),_(o.renderLink?1:2)}}function te(e,n){if(e&1&&(c(0,"tr"),M(1,ee,3,1,"td",null,U),s()),e&2){let o=a();d(),T(o.orderedColumns())}}var L=(()=>{let n=class n{constructor(){this.data=v.required(),this.columns=v.required(),this.rowIdField=v("id"),this.persistenceKey=v("default"),this.orderBy=I(),this.searchQuery=I(),this.query=V(""),this.sort=u(null),this.orderedColumns=u([]),this.visibleData=g(()=>{let r=this.query(),t=this.sort(),i=[...this.data()?this.data():[]];if(r){let m=this.orderedColumns();i=i.filter(w=>m.some(k=>String(w[k.field]??"").toLowerCase().includes(r.toLowerCase()))),this.searchQuery.emit(r)}if(t){let{column:m,direction:w}=t;i.sort((k,j)=>{let E=String(k[m]??""),K=String(j[m]??"");return w==="asc"?E.localeCompare(K):K.localeCompare(E)})}return i}),O(()=>this.orderedColumns.set(this.columns()))}getSortIndicator(r){let t=this.sort();return!t||t.column!==r.field?"":t.direction==="asc"?"\u2191":"\u2193"}toggleSort(r){if(!r.sortable)return;let t=this.sort();if(!t||t.column!==r.field){let i={column:r.field,direction:"asc"};this.sort.set(i),this.orderBy.emit(i);return}if(t.direction==="asc"){let i={column:r.field,direction:"desc"};this.sort.set(i),this.orderBy.emit(i)}else this.sort.set(null)}renderCell(r,t){return t.render?t.render(r):String(this.getRowValue(r,t.field)??"")}getRenderLink(r,t){if(!r.renderLink)return[];let i=r.renderLink(t);return Array.isArray(i)?i:[i.url]}getRowValue(r,t){return t.split(".").reduce((i,m)=>i&&i[m]!==void 0?i[m]:null,r)}};n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=y({type:n,selectors:[["app-data-table"]],hostAttrs:["role","grid",1,"data-table"],inputs:{data:[1,"data"],columns:[1,"columns"],rowIdField:[1,"rowIdField"],persistenceKey:[1,"persistenceKey"],query:[1,"query"]},outputs:{orderBy:"orderBy",searchQuery:"searchQuery",query:"queryChange"},decls:8,vars:0,consts:[[3,"ngClass"],["type","button",1,"unstyled",3,"click"],[1,"sort-indicator"],[3,"routerLink"]],template:function(t,i){t&1&&(c(0,"table")(1,"thead")(2,"tr"),M(3,X,4,5,"th",0,H),s()(),c(5,"tbody"),M(6,te,3,0,"tr",null,J,!0),s()()),t&2&&(d(3),T(i.orderedColumns()),d(3),T(i.visibleData()))},dependencies:[Q,A,P],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;gap:1rem}table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;border:1px solid var(--border);border-radius:4px;overflow:hidden}thead[_ngcontent-%COMP%]{background:var(--bg-head)}thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{text-align:left;font-weight:600;padding:.75rem 1rem;border-bottom:2px solid var(--border);border-right:1px solid var(--border)}thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]:last-child{border-right:none}tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{transition:background-color .15s ease}tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-child(odd){background:var(--bg)}tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-child(2n){background:var(--bg-alt)}tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background:var(--hover)!important;cursor:pointer}tbody[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:.75rem 1rem;border-bottom:1px solid var(--border);border-right:1px solid var(--border)}tbody[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:last-child{border-right:none}tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:last-child   td[_ngcontent-%COMP%]{border-bottom:none}.sortable[_ngcontent-%COMP%]{cursor:pointer;-webkit-user-select:none;user-select:none}.sortable[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}.sort-indicator[_ngcontent-%COMP%]{font-size:.875rem;opacity:.7}button.unstyled[_ngcontent-%COMP%]{background:none;border:none;padding:0;font:inherit;cursor:pointer;color:inherit}"]});let e=n;return e})();function ne(e){return[e,{provide:h,useExisting:e}]}var h=class{constructor(){this.facade=f(R),this._data=u([]),this._schema=u(null),this.canCreate=u(!0),this.columns=g(()=>this.fetchColumnSchema(this.schema()?.columns??[])),this.persistenceKey=g(()=>this.schema()?.persistenceKey),this.data=g(()=>this.fetchData(this._data())),this.schema=g(()=>this.fetchSchema(this._schema())),O(()=>this._data.set(this.facade.data()))}fetchData(n){return n}fetchSchema(n){return n}fetchColumnSchema(n){return n}initialize(){return Promise.resolve()}};function re(e,n){e&1&&(c(0,"p"),l(1,"Loading data..."),s())}function ie(e,n){e&1&&(c(0,"a",1),l(1,"Create"),s())}function oe(e,n){if(e&1){let o=D();c(0,"app-data-table",3),S("orderBy",function(t){b(o);let i=a(2);return C(i.onOrderBy(t))})("searchQuery",function(t){b(o);let i=a(2);return C(i.onSearch(t))}),s()}if(e&2){let o=a(2);x("data",o._service.data())("columns",o._service.columns())("persistenceKey",o._service.persistenceKey())}}function ae(e,n){if(e&1&&(c(0,"div",0),p(1,ie,2,0,"a",1),s(),p(2,oe,1,3,"app-data-table",2)),e&2){let o=a();d(),_(o._service.canCreate()?1:-1),d(),_(o._service.schema()?2:-1)}}var ce=(()=>{let n=class n{constructor(){this._service=f(h),this._cdr=f($)}async ngOnInit(){await this._service.facade.populate(),this._cdr.detectChanges()}onOrderBy(r){this._service.facade.sort(r)}onSearch(r){this._service.facade.filter({query:r})}};n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=y({type:n,selectors:[["ng-component"]],decls:2,vars:1,consts:[[1,"data-table-header"],["routerLink","../create",1,"btn-create"],[3,"data","columns","persistenceKey"],[3,"orderBy","searchQuery","data","columns","persistenceKey"]],template:function(t,i){t&1&&p(0,re,2,0,"p")(1,ae,3,2),t&2&&_(i._service.facade.loading()?0:1)},dependencies:[L,P],styles:["[_nghost-%COMP%]{display:block;position:relative;min-height:200px}.data-table-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem}.btn-create[_ngcontent-%COMP%]{padding:.5rem 1rem;background:var(--primary);color:#fff;border-radius:4px;text-decoration:none;cursor:pointer}"]});let e=n;return e})();var se=new q("DataTableSchemaScope");export{L as a,ne as b,h as c,ce as d,se as e};
