import{a as oe}from"./chunk-RAPXP5WM.js";import{b as H}from"./chunk-5PREXRHO.js";import{D as J,E as K,H as Q,I as U,J as W,K as X,M as Y,N as Z,O as ee,P as te,S as ie}from"./chunk-2YE4WXBL.js";import{r as z,t as B}from"./chunk-VSR5JVYN.js";import{$a as f,Ab as L,Ja as R,La as $,Ma as A,N as P,S as d,Tb as S,Ub as q,Va as g,Wa as b,X as M,Xa as j,Y as N,Ya as I,Za as c,Zb as O,_a as _,ab as l,da as p,hb as D,ia as G,jb as w,lb as a,ua as u,zb as C}from"./chunk-WWCH6M6L.js";import{d as F,e as k,f as T}from"./chunk-AFABBANU.js";var v=(()=>{let e=class e{constructor(){this.id=p(null),this.mode=p("create"),this.model=p(null)}};e.\u0275fac=function(r){return new(r||e)},e.\u0275prov=P({token:e,factory:e.\u0275fac});let t=e;return t})(),V=(()=>{let e=class e extends v{};e.\u0275fac=(()=>{let o;return function(s){return(o||(o=G(e)))(s||e)}})(),e.\u0275prov=P({token:e,factory:e.\u0275fac});let t=e;return t})();function se(t){return[t,{provide:y,useExisting:t},{provide:v,useExisting:V},V]}function Re(t){return{providers:[se(t)],path:":id",loadComponent:()=>import("./chunk-UT73TRE7.js").then(e=>e.FormTemplate)}}var y=class{constructor(){this._modelProvider=d(v),this._schema=p(null),this._returnRoute=p(["../list"]),this._onChangeSubscriptions=new Map,this.schema=this._schema.asReadonly(),this.returnRoute=this._returnRoute.asReadonly(),this.facade=d(H),this.model=this._modelProvider.model.asReadonly(),this.mode=this._modelProvider.mode.asReadonly(),this.isLoading=this.facade.loading}buildFormControls(e,i){return(this.schema()?.fields||[]).forEach(o=>{if(o.type==="collection"){let r=i?.[o.key]??[],s=e.get(o.key);if(s&&Array.isArray(r)){for(;s.length>0;)s.removeAt(0);r.forEach(x=>{if(o.itemFields?.length){let n={};o.itemFields.forEach(h=>{let ae=h.createControl("edit",!!h.disabled);n[h.key]=ae});let m=new W(n);s.push(m)}else s.push(new X(x))})}}}),i}registerOnChangeHandlers(e,i){e.fields.forEach(o=>{if(!o.onChange)return;let r=i.get(o.key);if(!r)return;let s=this.getRootFormGroup(r);if(!s)return;let x=()=>{o.onChange(r,i),o.root.onChange(s)},n=r.valueChanges.subscribe(()=>queueMicrotask(x));this._onChangeSubscriptions.set(o.key,n),queueMicrotask(x)})}getRootFormGroup(e){let i=e.parent;for(;i?.parent;)i=i.parent;return i}cleanupOnChangeSubscriptions(){this._onChangeSubscriptions.forEach(e=>e.unsubscribe()),this._onChangeSubscriptions.clear()}initialize(){return this.facade.initialize()}};var re=(()=>{let e=class e{constructor(){this._service=d(y),this.form=p(null)}ngOnInit(){let o=this._service.schema();if(o){let r=o.buildFormGroup();this.form.set(r)}}async onSubmit(){let o=this.form();!o||o.invalid||await this.submit(o.value)}ngOnDestroy(){this._service.cleanupOnChangeSubscriptions()}};e.\u0275fac=function(r){return new(r||e)},e.\u0275dir=$({type:e});let t=e;return t})();var ce=(t,e)=>e.key;function me(t,e){if(t&1&&l(0,"input",3),t&2){let i=a().$implicit;c("id",i.key)("formControlName",i.key)}}function le(t,e){if(t&1&&l(0,"textarea",4),t&2){let i=a().$implicit;c("id",i.key)("formControlName",i.key)}}function de(t,e){if(t&1&&l(0,"input",5),t&2){let i=a().$implicit;c("id",i.key)("formControlName",i.key)}}function pe(t,e){if(t&1&&l(0,"input",6),t&2){let i=a().$implicit;c("id",i.key)("formControlName",i.key)}}function ue(t,e){if(t&1&&l(0,"input",7),t&2){let i=a().$implicit;c("id",i.key)("formControlName",i.key)}}function fe(t,e){if(t&1&&l(0,"input",8),t&2){let i=a().$implicit;c("id",i.key)("formControlName",i.key)}}function _e(t,e){if(t&1&&l(0,"input",3),t&2){let i=a().$implicit;c("id",i.key)("formControlName",i.key)}}function he(t,e){if(t&1&&(_(0,"div",1)(1,"label",2),C(2),f(),g(3,me,1,2,"input",3)(4,le,1,2,"textarea",4)(5,de,1,2,"input",5)(6,pe,1,2,"input",6)(7,ue,1,2,"input",7)(8,fe,1,2,"input",8)(9,_e,1,2,"input",3),f()),t&2){let i,o=e.$implicit;u(),c("for",o.key),u(),L(o.label),u(),b((i=o.type)==="text"?3:i==="textarea"?4:i==="number"?5:i==="date"?6:i==="checkbox"?7:i==="password"?8:9)}}function Ce(t,e){if(t&1&&(_(0,"form",0),j(1,he,10,3,"div",1,ce),f()),t&2){let i=a();c("formGroup",i.form()),u(),I(i.schema().fields)}}var ne=(()=>{let e=class e{constructor(){this.schema=O(null),this.form=O(null)}};e.\u0275fac=function(r){return new(r||e)},e.\u0275cmp=R({type:e,selectors:[["app-form-renderer"]],inputs:{schema:[1,"schema"],form:[1,"form"]},decls:1,vars:1,consts:[[3,"formGroup"],[1,"form-field"],[3,"for"],["type","text",3,"id","formControlName"],[3,"id","formControlName"],["type","number",3,"id","formControlName"],["type","date",3,"id","formControlName"],["type","checkbox",3,"id","formControlName"],["type","password",3,"id","formControlName"]],template:function(r,s){r&1&&g(0,Ce,3,1,"form",0),r&2&&b(s.form()&&s.schema()?0:-1)},dependencies:[ie,Y,K,Z,J,Q,U,ee,te],styles:[".form-field[_ngcontent-%COMP%]{display:flex;flex-direction:column;margin-bottom:1rem}label[_ngcontent-%COMP%]{font-weight:600;margin-bottom:.25rem}input[_ngcontent-%COMP%], textarea[_ngcontent-%COMP%]{padding:.5rem;border:1px solid var(--border);border-radius:4px}"]});let t=e;return t})();function ge(t,e){t&1&&(_(0,"p"),C(1,"Loading form data..."),f())}function be(t,e){if(t&1){let i=D();_(0,"button",5),w("click",function(){M(i);let r=a(2);return N(r.remove())}),C(1," Delete "),f()}}function ve(t,e){if(t&1){let i=D();_(0,"div",0)(1,"button",1),w("click",function(){M(i);let r=a();return N(r.onSubmit())}),C(2," Save "),f(),g(3,be,2,0,"button",2),_(4,"button",3),w("click",function(){M(i);let r=a();return N(r.returnToList())}),C(5," Return "),f()(),l(6,"app-form-renderer",4)}if(t&2){let i=a();u(),c("disabled",i.form().invalid),u(2),b(i._service.mode()==="edit"&&i._service.schema().canDelete(i.form().value)?3:-1),u(3),c("schema",i.schema())("form",i.form())}}var Je=(()=>{var e,i,o;let r=class r extends re{constructor(){super();k(this,e);k(this,i);k(this,o);this._modelProvider=d(v),this.schema=S(()=>this._service.schema()),T(this,e,S(()=>this._service.returnRoute())),T(this,i,d(z)),T(this,o,d(B)),this.routeParams=oe(F(this,i).params),q(()=>{let n=this.routeParams();n&&(this._modelProvider.id.set(n.id),this._modelProvider.mode.set(n.id==="create"?"create":"edit"))})}async submit(n){await this.executeSubmit(n)&&this.returnToList()}async executeSubmit(n){let m=structuredClone(this._service.model())??n;return Object.assign(m,n),(this._modelProvider.mode()==="create"?await this._service.facade.create("",m):await this._service.facade.update(this._modelProvider.id()??"",m)).success}async remove(){await this._service.facade.delete(this._modelProvider.id()),this.returnToList()}returnToList(){F(this,o).navigate(F(this,e).call(this))}};e=new WeakMap,i=new WeakMap,o=new WeakMap,r.\u0275fac=function(m){return new(m||r)},r.\u0275cmp=R({type:r,selectors:[["app-form-template"]],features:[A],decls:2,vars:1,consts:[[1,"form-actions-top"],["type","button",1,"btn-submit",3,"click","disabled"],["type","button",1,"btn-delete"],["type","button",1,"btn-return",3,"click"],[3,"schema","form"],["type","button",1,"btn-delete",3,"click"]],template:function(m,h){m&1&&g(0,ge,2,0,"p")(1,ve,7,4),m&2&&b(h._service.isLoading()?0:h.form()?1:-1)},dependencies:[ne],styles:["[_nghost-%COMP%]{display:block;position:relative;min-height:200px}.form-actions-top[_ngcontent-%COMP%]{display:flex;gap:.5rem;margin-bottom:1rem}.btn-submit[_ngcontent-%COMP%]{padding:.5rem 1rem;background:var(--primary);color:#fff;border:none;border-radius:4px;cursor:pointer}.btn-delete[_ngcontent-%COMP%]{padding:.5rem 1rem;background:var(--danger, #dc3545);color:#fff;border:none;border-radius:4px;cursor:pointer}.btn-return[_ngcontent-%COMP%]{padding:.5rem 1rem;background:var(--secondary, #6c757d);color:#fff;border:none;border-radius:4px;cursor:pointer}.btn-submit[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}"]});let t=r;return t})();export{v as a,V as b,re as c,ne as d,Je as e,se as f,Re as g,y as h};
