import{x as I}from"./chunk-2YE4WXBL.js";import{o as S}from"./chunk-VSR5JVYN.js";import{N as h,Q as f,S as c,Tb as O,da as l,f as x,k as w,o as d,x as y}from"./chunk-WWCH6M6L.js";import{a as v,b}from"./chunk-AFABBANU.js";var m=(()=>{let t=class t{constructor(){this._message=c(I)}error(e){this.message(e,"error"),console.error({input:e})}success(e){this.message(e,"success"),console.info({input:e})}message(e,s){this._message.add({severity:s,summary:e.title,detail:e.message})}};t.\u0275fac=function(s){return new(s||t)},t.\u0275prov=h({token:t,factory:t.\u0275fac,providedIn:"root"});let i=t;return i})(),r=class{constructor(t){this.title=null,this.message=null,Object.assign(this,t)}};var p=class{constructor(t){this.success=!1,this.message=null,Object.assign(this,t)}};var _=(()=>{let t=class t{constructor(){this._apiUrl="/api",this._http=c(S),this._message=c(m)}getObservable(e,s={},n={}){return this._http.get(`${this._apiUrl}/${e}`,{params:s,headers:structuredClone(n)}).pipe(this.handleException())}postObservable(e,s){return this._http.post(`${this._apiUrl}/${e}`,s).pipe(this.handleException())}deleteObservable(e){return this._http.delete(`${this._apiUrl}/${e}`).pipe(this.handleException())}putObservable(e,s){return this._http.put(`${this._apiUrl}/${e}`,s).pipe(this.handleException())}async get(e,s={},n={}){let o={success:!1,message:"Internal exception",data:void 0};try{o=await d(this.getObservable(e,s,n))}catch($){o.message=$.message??o.message}return o}async delete(e){let s={success:!1,message:"Internal exception",data:void 0};try{s=await d(this.deleteObservable(e))}catch(n){s.message=n.message??s.message}return s}async post(e,s){let n={success:!1,message:"Internal exception",data:void 0};try{n=await d(this.postObservable(e,s))}catch(o){n.message=o.message??n.message}return n}async put(e,s){let n={success:!1,message:"Internal exception",data:void 0};try{n=await d(this.putObservable(e,s))}catch(o){n.message=o.message??n.message}return n}handleException(){return y(e=>{let s;return e.status===0?s=new r({title:"Service not responding",message:"Service is offline"}):e.status===401?s=new r({title:"Unauthorized",message:"Authentication required"}):e.status===403?s=new r({title:"Forbidden",message:"No permission"}):e.status===405?s=new r({title:"Method not allowed",message:"Method not implemented"}):s=new r({title:"Error",message:"Something went wrong"}),this._message.error(s),w(new p({message:s.title}))})}};t.\u0275fac=function(s){return new(s||t)},t.\u0275prov=h({token:t,factory:t.\u0275fac,providedIn:"root"});let i=t;return i})();function z(i){return[{provide:g,useExisting:i},{provide:j,useExisting:i},{provide:N,useExisting:i}]}var j=new f("populateFacadeScope"),N=new f("facadeScope");var u=class{get onLoaded(){return this._onLoaded.asObservable()}constructor(t,a){this._data=null,this._initialized=l(!1),this._requiresInitialization=l(!0),this._api=c(_),this._loading=l(!1),this._saving=l(!1),this._deleting=l(!1),this._filter=l({}),this._endpoint=null,this.data=O(()=>this.withData(this._data())),this.initialized=this._initialized.asReadonly(),this.loading=this._loading.asReadonly(),this.saving=this._saving.asReadonly(),this.deleting=this._deleting.asReadonly(),this._onLoaded=new x,this._endpoint=a,this._data=l(t)}async initialize(){this._requiresInitialization()&&this._initialized()||await this.populate()}async populate(){if(this._loading())return this;let t={},a=this._filter();Object.values(a).length&&(t.filter=JSON.stringify(a)),this._loading.set(!0);let e=await this._api.get(this._endpoint,{},t);return this._loading.set(!1),e.success&&e.data&&(this._data.set(e.data),this._initialized.set(!0)),this._onLoaded.next(null),this}async update(t,a){this._saving.set(!0);let e=await this._api.put(`${this._endpoint}/${t}`,a);return this._saving.set(!1),e.success&&await this.populate(),e}async create(t,a){t??="",this._saving.set(!0);let e=await this._api.post(`${this._endpoint}${t}`,a);return this._saving.set(!1),e.success&&await this.populate(),e}async delete(t){this._deleting.set(!0);let a=await this._api.delete(`${this._endpoint}/${t}`);return this._deleting.set(!1),a.success&&await this.populate(),a}withData(t){return t}async sort(t){await this.filter(b(v({},this._filter()),{sort:t}))}async filter(t){let a=JSON.stringify(t),e=JSON.stringify(this._filter());a!==e&&(this._filter.set(t),await this.populate())}},g=class extends u{getById(t){return this.data().find(a=>a.id===t)??null}};export{z as a,N as b,g as c};
